# ═══════════════════════════════════════════════════════════════════════════
# ENHANCED CLAIMS FRAUD DETECTION CONFIGURATION
# All values configurable - NO hardcoded values in code!
# Version: 2.0
# Date: 2026-02-11
# ═══════════════════════════════════════════════════════════════════════════

# ═══════════════════════════════════════════════════════════════════════════
# DATA CONFIGURATION
# ═══════════════════════════════════════════════════════════════════════════
data:
  # ─────────────────────────────────────────────────────────────────────────
  # FILE PATHS
  # ─────────────────────────────────────────────────────────────────────────
  train_path: "data/claims_train.parquet"
  val_path: null  # null = auto-split from train
  test_path: null  # null = auto-split from train
  
  # ─────────────────────────────────────────────────────────────────────────
  # FEATURE LISTS
  # ─────────────────────────────────────────────────────────────────────────
  numerical_features:
    - claim_amount
    - patient_age
    - provider_experience_years
    - days_since_last_claim
    - num_previous_claims
    - average_claim_amount
    - claim_duration_days
    
  categorical_features:
    - claim_type
    - provider_specialty
    - diagnosis_code
    - procedure_code
    - patient_gender
    - geographic_region
  
  # ─────────────────────────────────────────────────────────────────────────
  # FEATURE SCHEMAS (Data types, ranges, validation)
  # ─────────────────────────────────────────────────────────────────────────
  feature_schemas:
    claim_amount:
      dtype: float
      min_value: 0
      max_value: 1000000
      default_value: 0
      required: true
      distribution: gamma
      dist_params: {shape: 2, scale: 1000}
      
    patient_age:
      dtype: int
      min_value: 0
      max_value: 120
      default_value: 45
      required: true
      distribution: uniform
      dist_params: {low: 18, high: 90}
      
    provider_experience_years:
      dtype: int
      min_value: 0
      max_value: 50
      default_value: 10
      required: false
      distribution: uniform
      dist_params: {low: 0, high: 40}
      
    days_since_last_claim:
      dtype: float
      min_value: 0
      max_value: 3650
      default_value: 30
      required: false
      distribution: exponential
      dist_params: {scale: 30}
      
    num_previous_claims:
      dtype: int
      min_value: 0
      max_value: 100
      default_value: 0
      required: true
      distribution: poisson
      dist_params: {lam: 2}
      
    average_claim_amount:
      dtype: float
      min_value: 0
      max_value: 500000
      default_value: 5000
      required: false
      distribution: gamma
      dist_params: {shape: 2, scale: 800}
      
    claim_duration_days:
      dtype: int
      min_value: 1
      max_value: 365
      default_value: 7
      required: true
      distribution: uniform
      dist_params: {low: 1, high: 60}
  
  # ─────────────────────────────────────────────────────────────────────────
  # CATEGORICAL DOMAINS (Allowed values for each category)
  # ─────────────────────────────────────────────────────────────────────────
  categorical_domains:
    claim_type:
      values: [medical, dental, vision, prescription, other]
      default: medical
      required: true
      
    provider_specialty:
      values: [general, specialist, surgeon, pediatrics, orthopedics, cardiology, neurology]
      default: general
      required: false
      
    diagnosis_code:
      values: [D001, D002, D003, D004, D005, D006, D007, D008, D009, D010]
      pattern: "D[0-9]{3}"
      default: D001
      required: true
      
    procedure_code:
      values: [P001, P002, P003, P004, P005]
      pattern: "P[0-9]{3}"
      default: P001
      required: true
      
    patient_gender:
      values: [M, F, O, Unknown]
      default: Unknown
      required: true
      
    geographic_region:
      values: [North, South, East, West, Central, Northeast, Southeast, Northwest, Southwest]
      default: Central
      required: false
  
  # ─────────────────────────────────────────────────────────────────────────
  # DISPLAY NAMES (Human-readable labels for UI)
  # ─────────────────────────────────────────────────────────────────────────
  display_names:
    claim_amount: "Claim Amount ($)"
    patient_age: "Patient Age (years)"
    provider_experience_years: "Provider Experience (years)"
    days_since_last_claim: "Days Since Last Claim"
    num_previous_claims: "Number of Previous Claims"
    average_claim_amount: "Average Claim Amount ($)"
    claim_duration_days: "Claim Duration (days)"
    claim_type: "Claim Type"
    provider_specialty: "Provider Specialty"
    diagnosis_code: "Diagnosis Code"
    procedure_code: "Procedure Code"
    patient_gender: "Patient Gender"
    geographic_region: "Geographic Region"
  
  # ─────────────────────────────────────────────────────────────────────────
  # DATA QUALITY
  # ─────────────────────────────────────────────────────────────────────────
  data_quality:
    default_missing_rate: 0.05
    missing_patterns:
      claim_amount: 0.02
      patient_age: 0.01
      provider_experience_years: 0.05
      days_since_last_claim: 0.10
      num_previous_claims: 0.01
      average_claim_amount: 0.08
      claim_duration_days: 0.03
      claim_type: 0.02
      provider_specialty: 0.06
      diagnosis_code: 0.01
      procedure_code: 0.01
      patient_gender: 0.02
      geographic_region: 0.04
  
  # ─────────────────────────────────────────────────────────────────────────
  # IMPUTATION
  # ─────────────────────────────────────────────────────────────────────────
  imputation:
    numerical:
      strategy: median  # Options: mean, median, most_frequent, constant
      fill_value: 0
    categorical:
      strategy: most_frequent
      fill_value: "Unknown"
  
  # ─────────────────────────────────────────────────────────────────────────
  # OUTLIER TREATMENT
  # ─────────────────────────────────────────────────────────────────────────
  outlier_treatment:
    enabled: true
    method: iqr  # Options: iqr, zscore, winsorize
    iqr:
      lower_quantile: 0.25
      upper_quantile: 0.75
      threshold_multiplier: 3.0
    zscore:
      threshold: 3.0
    winsorize:
      lower_percentile: 0.01
      upper_percentile: 0.99
  
  # ─────────────────────────────────────────────────────────────────────────
  # SCALING
  # ─────────────────────────────────────────────────────────────────────────
  scaling:
    method: robust  # Options: standard, robust, minmax, maxabs
    with_centering: true
    with_scaling: true
    quantile_range: [25, 75]
  
  # ─────────────────────────────────────────────────────────────────────────
  # CATEGORICAL ENCODING
  # ─────────────────────────────────────────────────────────────────────────
  categorical_encoding:
    method: label  # Options: label, onehot, target, ordinal
    handle_unknown: most_frequent
    min_frequency: 0.01
    max_categories: 50
  
  # ─────────────────────────────────────────────────────────────────────────
  # FEATURE ENGINEERING
  # ─────────────────────────────────────────────────────────────────────────
  feature_engineering:
    interactions:
      enabled: true
      pairs:
        - [claim_amount, patient_age]
        - [num_previous_claims, average_claim_amount]
        - [claim_duration_days, claim_amount]
    derived_features:
      - name: claim_per_age
        formula: "claim_amount / (patient_age + 1)"
        dtype: float
      - name: days_per_claim
        formula: "claim_duration_days / (num_previous_claims + 1)"
        dtype: float
      - name: claim_frequency
        formula: "num_previous_claims / (days_since_last_claim + 1)"
        dtype: float
  
  # ─────────────────────────────────────────────────────────────────────────
  # SPLIT RATIOS
  # ─────────────────────────────────────────────────────────────────────────
  split_ratios:
    train: 0.7
    val: 0.15
    test: 0.15
  
  # ─────────────────────────────────────────────────────────────────────────
  # FILE FORMATS
  # ─────────────────────────────────────────────────────────────────────────
  file_formats:
    parquet:
      engine: pyarrow
      compression: snappy
      index: false
    csv:
      sep: ","
      index: false
      encoding: utf-8
    pickle:
      protocol: 4
  
  # ─────────────────────────────────────────────────────────────────────────
  # SYNTHETIC DATA GENERATION
  # ─────────────────────────────────────────────────────────────────────────
  synthetic:
    default_samples: 1000
    random_seed: 42
    apply_missing_values: true
    apply_outliers: true
    outlier_rate: 0.05

# ═══════════════════════════════════════════════════════════════════════════
# BUSINESS RULES
# ═══════════════════════════════════════════════════════════════════════════
business_rules:
  fraud_thresholds:
    claim_amount_high_risk: 100000
    claim_amount_medium_risk: 50000
    max_claims_per_month: 5
    max_claims_per_week: 2
    rapid_claims_days: 7
    patient_age_min: 0
    patient_age_max: 120
    suspicious_age_ranges:
      - [0, 1]
      - [100, 120]
    min_provider_experience: 0
    suspicious_low_experience: 1
    
  alert_triggers:
    high_value_claim: 100000
    rapid_claims_count: 10
    rapid_claims_window_days: 7
    duplicate_claim_threshold: 0.95
    
  validation_rules:
    max_claim_duration_days: 365
    min_claim_duration_days: 1
    require_diagnosis_code: true
    require_procedure_code: true

# ═══════════════════════════════════════════════════════════════════════════
# UI CONFIGURATION
# ═══════════════════════════════════════════════════════════════════════════
ui:
  dashboard:
    title: "Claims Fraud Detection Dashboard"
    port: 8501
    host: localhost
    theme: light
    
  plots:
    default_height: 600
    default_width: 800
    show_gridlines: true
    color_scheme:
      fraud: "#ff0000"
      normal: "#00ff00"
      warning: "#ffaa00"
      info: "#0088cc"
      critical: "#cc0000"
    fraud_score_distribution:
      bins: 50
      show_percentiles: [95, 99]
      
  table_display:
    max_rows: 100
    rows_per_page: 25
    show_index: false
    float_precision: 2
    
  export:
    default_format: csv
    include_fraud_scores: true
    include_percentiles: true

# ═══════════════════════════════════════════════════════════════════════════
# MODEL CONFIGURATION
# ═══════════════════════════════════════════════════════════════════════════
model:
  encoding_dim: 32
  hidden_layers: [128, 64]
  activation: relu
  dropout_rate: 0.3
  batch_norm: true
  anomaly_threshold_percentile: 95

# ═══════════════════════════════════════════════════════════════════════════
# TRAINING CONFIGURATION
# ═══════════════════════════════════════════════════════════════════════════
training:
  batch_size: 256
  learning_rate: 0.001
  weight_decay: 0.0001
  optimizer: adam
  lr_scheduler:
    enabled: true
    type: reduce_on_plateau
    patience: 10
    factor: 0.5
    min_lr: 0.00001
  max_epochs: 100
  early_stopping:
    enabled: true
    patience: 15
    min_delta: 0.001
    monitor: val_loss
  gradient_clip_val: 1.0
  seed: 42
  deterministic: true
  accelerator: auto
  devices: 1
  precision: "32"

# ═══════════════════════════════════════════════════════════════════════════
# MLFLOW CONFIGURATION
# ═══════════════════════════════════════════════════════════════════════════
mlflow:
  enabled: true
  tracking_uri: mlruns
  experiment_name: claims_autoencoder
  run_name: null
  log_params: true
  log_metrics: true
  log_artifacts: true
  log_model: true
  tags:
    project: fraud_detection
    team: data_science
    environment: development

# ═══════════════════════════════════════════════════════════════════════════
# EVALUATION CONFIGURATION
# ═══════════════════════════════════════════════════════════════════════════
evaluation:
  metrics:
    - reconstruction_error
    - anomaly_detection_rate
    - precision_at_k
    - recall_at_k
  k_values: [10, 50, 100]
  plot_distributions: true
  plot_roc_curve: true
  save_plots: true
  plots_dir: outputs/plots

# ═══════════════════════════════════════════════════════════════════════════
# MONITORING CONFIGURATION
# ═══════════════════════════════════════════════════════════════════════════
monitoring:
  psi:
    enabled: true
    num_bins: 10
    thresholds:
      minor: 0.1
      major: 0.2
  drift_detection:
    enabled: true
    check_frequency: daily
    alert_threshold: 0.2

# ═══════════════════════════════════════════════════════════════════════════
# BATCH SCORING CONFIGURATION
# ═══════════════════════════════════════════════════════════════════════════
batch_scoring:
  chunk_size: 10000
  num_workers: 4
  save_reconstructions: false
  output_format: parquet

# ═══════════════════════════════════════════════════════════════════════════
# PATHS CONFIGURATION
# ═══════════════════════════════════════════════════════════════════════════
paths:
  data_dir: data
  models_dir: models
  outputs_dir: outputs
  logs_dir: logs
  checkpoints_dir: checkpoints
  exports_dir: exports

# ═══════════════════════════════════════════════════════════════════════════
# LOGGING CONFIGURATION
# ═══════════════════════════════════════════════════════════════════════════
logging:
  level: INFO
  log_file: logs/training.log
  log_to_console: true
  log_to_file: true
  format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
  date_format: "%Y-%m-%d %H:%M:%S"
